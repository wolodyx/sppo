# Текстовый интерфейс

В текстовом видеорежиме экран разбивается на прямоугольные области — знакоместа.
В каждой из этой области может находиться один символ из ограниченного набора.

Текстовый режим пришел на замену телетайпам, в которых информация печаталась на бумаге.
Технически это стало возможных благодаря появлению мониторов с электронно-лучевыми трубками.
Манипулировать каждым пикселем на экране еще не получалось из-за дороговизны памяти с произвольным доступом.

Возможность вывода символа на любом месте экрана позволяло редактировать информацию.
Также увеличило плотность изображения данных, не расходовалась бумага.

## Интерфейс командной строки

## Устройство видеоадаптера в текстовом режиме

Видеоадаптер, работающий в текстовом режиме, имеет две области памяти.
Первая область, текстовый буфер, хранит коды символов для каждого знакоместа.
Вторая область таблица символов, хранит битовое изображение каждого из 256 возможных символов.
Схема видеоадаптера превращала текстовый буфер в значения пикселей на экране.
Пиксел задается координатами X и Y.
По этим координатам вычисляется позиция знакоместа на экране через деление значений координат пикселя на размеры знакоместа.
Остаток от деления показывает координаты пикселя внутри знакоместа.
По координатам знакоместа из текстового буфера выбиралось значение символа.
А из таблицы символов по значению символа и координатам пикселя внутри знакоместа определялось значение пикселя на экране монитора.

Вычислим количество ячеек памяти, необходимой видеоадаптеру в текстовом режиме.
Пусть монитор имеет 80 на 25 знакомест.
Каждое знакоместо состоит из 9 на 14 пикселей.
Пиксель может иметь два состояния.
Тогда текстовый буфер занимает `80*25=2000` байт.
Таблица символов потребляет `256*((9-1)*(14-1))/8=3328` байт.
Заметим, что таблица символов может быть фиксированной и записана на микросхеме ПЗУ, что было дешевле ОЗУ.
Для графического режима, при котором каждый пиксель имел бы свое значение, нужна была бы память `(80x25)x(9x14)x1/8=31500` байтов.
Это больше в 16 раз для фиксированной таблицы символов и больше 6 раз при размещении таблицы символов в ОЗУ.
Но даже 32 Кб были слишком большими значениями для 1970 годов.

## Символы ASCII

```
   .0  .1  .2  .3  .4  .5  .6  .7  .8  .9  .A  .B  .C  .D  .E  .F
  ┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐
0.│NUL│SOH│STX│ETX│EOT│ENQ│ACK│BEL│BS │HT │LF │VT │FF │CR │SO │SI │
  ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
1.│DLE│DC1│DC2│DC3│DC4│NAK│SYN│ETB│CAN│EM │SUB│ESC│FS │GS │RS │US │
  ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
2.│   │ ! │ " │ # │ $ │ % │ & │ ' │ ( │ ) │ * │ + │ , │ - │ . │ / │
  ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
3.│ 0 │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │ 9 │ : │ ; │ < │ = │ > │ ? │
  ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
4.│ @ │ A │ B │ C │ D │ E │ F │ G │ H │ I │ J │ K │ L │ M │ N │ O │
  ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
5.│ P │ Q │ R │ S │ T │ U │ V │ W │ X │ Y │ Z │ [ │ \ │ ] │ ^ │ _ │
  ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
6.│ ` │ a │ b │ c │ d │ e │ f │ g │ h │ i │ j │ k │ l │ m │ n │ o │
  ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
7.│ p │ q │ r │ s │ t │ u │ v │ w │ x │ y │ z │ { │ | │ } │ ~ │DEL│
  └───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘
```

Управляющие символы:
|------|----|----|  
|      |    |    |  
|------|----|----|  
| NULL | 00 | \0 | 
| BEL  | 07 | \a | Звуковой сигнал 
| BS   | 08 | \b | 
| HT   | 09 | \t | 
| LF   | 0a | \n | 
| VT   | 0b | \v | 
| FF   | 0c | \f | 
| CR   | 0d | \r | 
| SO   | 0e |    |  
| SI   | 0f |    |  
| CAN  | 18 |    |  
| SUB  | 1a |    |  
| ESC  | 1b |    |  
| DEL  | 7f |    |  

## Кодовые страницы

Размер выводимого на экран символа составляет 8 бит, что позволяло иметь ему 256 различных значений.
Набор символов, сопоставленных каждому значению байта, называется кодовой страницей.
Существуют большое разнообразие кодовых страниц.
Так, в русской версии ОС Windows используется Windows-1251, русская версия UNIX-совместимых ОС использует 'KOI8', на компьютерах Mac — MacCyrillic.

Не все символы имеют графическое изображение.
Такие символы называют управляющими, в противоположность остальным — печатным.
Стандарт POSIX выделяет восемь управляющих символов.

|--------|---------------------------------------------|
| Символ |                 Обозначение                 |
|--------|---------------------------------------------|
|   \b   | Backspace, удаление символа перед курсором. |
|   \0   | NULL, конец строки, конец текстового файла. |
|   \t   | Tab, горизонтальная табуляция.              |
|   \n   | Перенос текста на новую строку.             |
|   \a   | Звуковой сигнал.                            |
|   \v   | Вертикальная табуляция.                     |
|   \f   | Перевод страницы.                           |
|   \r   | Возврат каретки.                            |

Печатные символы имеют графическое представление для вывода на экран. Сюда входят:
* буквы алфавита, как строчные (a, b, c, ..., z), так и заглавные (A, B, C, ..., Z);
* цифры (0, 1, 2, ..., 9);
* знаки препинания (.,,, :, !, &, ...);
* псевдографические символы.

Четырем наборам символов — управляющих, английским буквам, цифрам и знакам препинания — закреплены числовые коды от 0 до 127 стандартом ASCII.
Символы и их числовые коды представлены в виде таблицы ASCII.
Она занимает первую половину значений 8 битового символа.
Вторая половина определяется символами национального алфавита неанглоязычных стран.

ASCII символы позволяют изобразить на экране относительно сложные графические изображения.
Например, таблицы с заголовками (рисунок), объемные буквы (рисунок).
Эмоции могут быть изображены в виде смайлов улыбки :-), грусти :-(, смеха :-D, недовольства :-/, удивления o_O, сильного удивления 8-O и остального.
Направление в искусстве, при котором с помощью символов из таблицы ASCII представляют изображения, называется ASCII-графиков.

Для расширения возможностей рисования в текстовом режиме, таблица символов расширена псевдографическими элементами.
Их можно разделить на две части:
* символы для рисования рамок;
* блочные элементы.

## Командная оболочка

Интерфейс командной строки:
* командная оболочка: sh, bash csh, ...
* аргументы командной строки;
* readline
* команды для работы со строкой:
  *) история команд, поиск ctrl-r, ctrl-s; просмотр history; ctrl-p, ctrl-n предыдущие и следующая команда.
  *) редактирование и перемещение по строке: ctrl-d, ctrl-a, ctrl-e, ctrl-f, ctrl-b

Псевдографический интерфейс:
* последовательности управляющих символов;
* ncurses;

## Управляющие последовательности

Управляющие последовательности появились, потому что не хватило управляющих символов ASCII.
Многие клавиши, не связанные с печатными символами, а также комбинации клавиш, генерируют управляющие последовательности.

ESC 0x1B (033) 27
`printf("\0x1b")`
`printf("\033")`

## tmux

Одновременная работа в нескольких терминалах (в рамках одной сессии) возможна благодаря утилите `tmux`.
Она позволяет разбить терминальное окно на вложенные окна, называемые панелями.
Каждая панель выглядит как самостоятельный терминал и имеет свою историю команд.

```{figure} ../_images/tmux.png
```

`tmux` принимает команду после комбинации клавиш `ctrl-b`.
Отсюда, команда `%` вводится через последовательность `ctrl-b, %`.

Текущая панель разбивается пополам командами `%` и `"` по вертикали и горизонтали соответственно.
Панель закроется по команде оболочки `exit`.
Если закрывается последняя панель, то происходит выход из `tmux` в командную оболочку.
Переключение между панелями происходит по командам `→`, `←`, `↑`, `↓`.
Размер текущей панели настраивается клавишами перемещения (`→`, `←`, `↑`, `↓`) при набранном `ctrl-b`, но еще не отпущенном `ctrl`.

`tmux` позволяет держать открытыми одновременно текстовый редактор и интерпретатор команд.
Вы можете редактировать текст программы, собирать и запускать программу, просматривать результаты работы.

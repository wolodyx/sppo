# Распространение программного обеспечения

Программу, подготовленную для передачи пользователю, называют дистрибутивом.
Дистрибутив содержит в сжатом виде файлы программы и инструкцию по ее установке.
Малый размер позволяет хранить его компактно на диске и быстро передавать по сети.

Не всегда программу надо доставлять до пользователя.
Могут быть переданы ее результаты, а сама программа будет выполнена на стороне разработчика.
Такое поведение свойственно клиент-серверным и веб-приложениям.

Программа может быть установлена при передаче компьютера пользователю.
Такие программы называются предустановленными.
В первую очередь это ОС и наиболее популярные программы — текстовые редакторы, аудио- и видеопроигрыватели, веб-браузеры и остальное.
Большинство пользователей приобретают компьютер для работы или развлечения.
И администрировать систему они бы не хотели.
Особенно это касается мобильных устройств.

## История способов распространения ПО

Первые ЭВМ были громоздкими, единственными и уникальными в своем роде.
Специалисты, которые могли бы работать с ними, готовили на местах.
Все, кто как-то был связан с машиной, работали в одной организации — исследовательском институте или университете.
Разработчик программы одновременно был пользователем.
Он мог пешком дойти до машины, запустить программу из перфоленты и забрать данные.
Каждая ЭВМ обладала своей уникальной архитектурой и системой команд.
Программа создавалась под конкретную машину, и не подходила под другую.
Программа и машина были неотделимы друг от друга.

Толчком к отвязке программ от аппаратуры стало появление языков программирования высокого уровня — Кобол, Фортран и Си.
Это привело к появлению более сложных программ.
Часто используемые функции выносились в стандартные библиотеки — работу с файлами, математические функции, ввод и вывод данных.
Но ограниченность ресурсов ЭВМ, особенно памяти, а также отсутствие специалистов, программы оставались небольшими.
Программирование было научной дисциплиной и ограничивалось академическими кругами.
Развивались вычислительная математика и информатика.
Исходные коды программ печатали в научных статьях и журналах.

Взаимодействие с компьютером было не простым.
Чтобы отбить затраты на постройку  обслуживание, необходимо было более плотно использовать компьютерное время.
Исследователь приносил программу на перфокарте, а затем забирал результат выполнения.
Большая часть ошибок была связана с компиляцией.
Поэтому работа над программой затягивалась.
Многие исследователи были не связана с компиляцией.
Поэтому работа над программой затягивалась.
Многие исследователи были недовольны таким взаимодействием.
Это привело к появлению удаленного доступа к машине в многопользовательском режиме.
Работа проходила в диалоговом режиме.
В моменты ожидания ввода от пользователя, машина обрабатывала команды от других пользователей.

Революция в мире программирования началась с разработки ОС UNIX в 1969-1975 годах.
Система была разработана под доступный тогда коммерческий мини-компьютер PDP-7 и написана на языке программирования Си.
В ней были использованы простые концепции взаимодействия с пользователем, принципы модульного программирования, повторное использование кода.
Предложенные тогда идеи до сих пор остаются актуальными.
После демонстрации UNIX на конференции, она заинтересовала многих людей.
AT&T, внутри которой была разработана UNIX, не могла продавать ее из-за запрета государства заниматься компьютерным бизнесом.
Вследствие чего UNIX быстро распространилась по всему миру.
ОС могла быть собрана на любой машине, для которого существовал язык Си.
Язык был спроектирован максимально простым, близким к ассемблеру и минимальной стандартной библиотекой.

С распространением UNIX и появлению доступных компьютеров, разработчиков программ стало больше.
UNIX стала расширяться новыми программами.
Пользователи распространяли программы исходными кодами на носителях данных.
В начале это были аудиокассеты, а запись.
Считывания и копирования данных использовали магнитофон.
Программа записывалась на магнитную ленту кассеты в виде звукового сигнала.
С 1970-х аудиокассеты постепенно начали сменяться дискетами.
Дисковый привод появился на компьютерах Apple с 1984 года, а с 1987 года вошел в состав PS/2 и стал частью большинства персональных компьютеров.

Процесс распространения программ был далек от совершенства.
Еще не было сетей передачи данных и накопителей информации достаточного объема.
Это привело к появлению версий UNIX, слабо совместимых друг с другом.
Одинаковые в начале программы развивались параллельными ветвями в разных группах разработчиков.
Прорыв в этом деле произошел благодаря появлению утилиты patch в 1985 году.
Утилита patch позволяет переносить изменения между разными версиями текстового файла через так называемую заплатку.
Заплатка содержит только отличия между файлами в специальном текстовом формате и формируется утилитой patch.
Вместо того, чтобы передавать изменения файлы, передавались изменения в них.
Это уменьшало объем передовых данных и упрощал анализ изменений.

В 1984 году появилась межуниверситетская сеть NSFNET.

IBM, изначально поставлявшая первые компьютеры, начала терять монополию.
Удешевление и миниатюризация элементной базы позволили и другим фирмам начать разработку доступных компьютеров.
Ценность компьютера связана с задачами, которые он решает.
И эта ценность связана с программным обеспечением.
Покупатели готовы были приобрести компьютер, но им не хотелось заниматься разработкой и исправлением ошибок.
Им нужен был готовый инструмент за который они готовы платить.
Становилось понятным, что на программах можно заработать.
Фирмы выкупали успешные программы у их создателей.
Ограничивается доступ не только к исходным кодам, но и копирование двоичных файлов.
Программы стали охраняться государством так же, как литературные произведения.

Серийные коммерческие компьютеры поставляются с предустановленным ПО, стоимость которых была включена в стоимость компьютера.
Но не все были готовы платить.
В 1976 году Билл Гейтс написал открытое письмо компьютерным энтузиастам.
В нем он сожалел о том, что многие не платят за Altair BASIC денег.
Из-за этого разработчики не могут позволить себе улучшать свои программы.

Появление компьютерных сетей изменило способы распространения ПО.
Программу можно стало скачивать с удаленного сервера.
Также увеличились и масштабы нелегального использования.
Защиту программ от нелегального использования стали взламывать и выкладывать на сервера.
Доходы разработчиков упали из-за пиратства.
На любителях бесплатного ПО стали зарабатывать злоумышленники.
Вместе с установленной программой, на компьютер пользователя приходили и зловредные.
Проблема распространения поменялась проблемой нераспространения.
Нарушителей лицензий на ПО преследовали, сервера с программами закрывали.
Со временем объемы пиратства уменьшились за счет развития правовой культуры, появлением удобного и свободного ПО.

Решение проблемы распространения программ в среде Интернет, где источникам нет доверия — это централизованное распространение через доверенные источники.
Такой моделью пользуются UNIX-подобные ОС.
Программы для них распространялись через репозитории.
Репозиторий — это набор программ, собранных в одном месте — на носителе информации или удаленном сервере.

С появлением мобильных устройств (смартфонов и планшетов) и их распространением среди пользователей, не разбирающихся в компьютерах, возникли магазины приложений.
Они контролируются разработчиками ОС — Apple, Google, Microsoft и другие.
Магазины решали многие проблемы, возникшие ранее — безопасность, соблюдений лицензионных условий, оплата.

Наравне с мобильными устройствами, стали развиваться облачные технологии — сервера, предоставляющие свои ресурсы — вычислительные, сетевые и программные.
Разработчик может создать свое веб-приложение и воспользоваться ресурсами таких серверов и найти своих пользователей.
Его программа становилась доступным через сеть и веб-браузер.
А задача распространения с сопутствующими ее проблемами уже не стоит.
Лишь бы знал пользователь адрес сайта.
Распространение сводится к рекламе или, по другому — к продвижению приложения.
Платформ, для которых можно написать приложение, стало больше.
Это не только настольные и мобильные устройства, но и социальные сети и мессенджеры — приложение для “ВКонтакте”, игра для “Одноклассники”, чат-бот для “Telegram” и многое другое.
Такие программы представляют собой клиент-серверное приложение, установленное в облаке.
А клиентами программы являются пользователи платформы, точнее — веб-приложения, которым они пользуются.

## Проблемы при распространении ПО

Доставка программы должна быть быстрой.
Поэтому все дистрибутивы архивируются.
Также сжатые данные эффективнее используются дисковое пространства на сервере.
Если дистрибутив слишком большой и содержит компоненты, которые пользователь не захочет устанавливать, то используют технику bootstrap loading.
Пользователь взамен дистрибутива скачивает малую по размеру вспомогательную программу.
А установка программы превратится в установку со скачиванием.

Не всегда верно утверждение, но доставка программы должна быть незаметной для пользователя.
Конечно же , только если пользователь этого хочет.
После исправления ошибок или добавления новой функциональности программу нужно обновить.
Не всегда пользователь осознает полезность новой версии программы, но изменения могут быть критичными — например, связанные с безопасностью.
Поэтому некоторые программы обновляют сами себя (техника bootstrap loading) или же обновляет система (СУП).

Доставкой, установкой и обновлением процесс не заканчивается.
Разработчик хочет получить обратную связь, собрать статистику и получить отчет об использовании программы.
Пользователь захочет сообщить об ошибках, получить техническую консультацию и поддержку.
Или же поделиться опытом использования программы с другими пользователями.

Кроме программы, дистрибутив может содержать вредоносный код.
Сразу исключим ситуацию, когда окд добавил разработчик.
Установить такую программу лучше бы не стоило.
Поэтому загружать программу для установки нужно только из доверенных источников — сайта разработчика, официального репозитория, магазина приложений.

Чтобы обнаружить факт внесения изменений в уже сформированный дистрибутив, используют сверку хеш-сумма.
С загружаемым файлом связывают набор шестнадцатеричных чисел (как пример fd76669ff38a79b990da736930f2ca07).
У загруженного файла с помощью утилиты вычисляют хеш-сумму и сравнивает с приложенным.
Если они совпадают, то файл не был изменен с момента его формирования.

Другой способ проверки дистрибутива — это использование цифрового сертификата для подписи файлов.
В этом случае также вычисляется хеш-сумма файла, но она шифруется с помощью приватного ключа разработчика и вместе с сертификатом прикладывается к файлу.
При запуске файла ОС проверяет зашифрованных хеш с помощью публичного ключа.
Если хэши совпадают, то файл может быть запущен.
В зависимости от организации, которая выдала цифровой сертификат разработчику, ОС может довериться файлу или же выдать предупреждение.
Сертификат содержит информацию о разработчике, которая будет показана при запуске файла.

**Ограничение и контроль распространения**.
Регистрация перед скачиванием — узнать о пользователях.
Закрытие доступа к файлообменным сервисам, юридическое преследование пользователей, чтобы им больше не хотелось использовать программу.

## Программа в исходных кодах

Программа передается не в виде двоичных файлов, а исходными кодами и инструкциями по их сборке.
Программа в двоичной форме может быть использована только под конкретную платформу, которая определяется используемой ОС, компилятором, процессором.
Для каждой новой платформы ее необходимо заново собирать.
Существуют слабо распространенные платформы и единственным способом получить для них программу — это собрать ее из исходных кодов.
Как пример, такими платформами могут выступать — отечественный процессор Эльбрус, комплект разработки Raspberry Pi, нераспространенные в настольных компьютерах процессоры ARM.

Программы с открытым исходным кодом доступны в виде репозиториев систем управления версиями (СУВ) Git, Hg.
Исходные коды программы могут быть скачаны из публично доступного репозитория с помощью утилиты Git.

Архивы исходных кодов программы могут быть переданы архивом или загружены через сеть из репозитория (инструментами системы управления пакетами или системы управления версиями).

## Архив с программой

Архивирование используется обязательно при создании любых дистрибутивов.
Оно уменьшает размер распространяемых данных, особенно сильно заметно на текстовых данных .
Добавляет информацию для восстановления данных при повреждении архива.

Архиваторы входят в состав ОС в виде утилиты по умолчанию.
Они позволяют объединять файлы и сжимать их в архивы.
А также выполнять обратные действие.
Программа, упакованная в такой архив, может быть без проблем распакована на компьютере.

В ОС Windows наиболее популярны два архиватора.
Это коммерческий WinRAR (файлы *.rar) и свободный 7-Zip (файлы *.7z).
Это графические приложения с большим набором функций.
Они поддерживают различные методы сжатия и форматы файлов.
В отличие от Windows, в UNIX-подобных ОС программа делает хорошо только одну функцию.
Для архивирования используют разные утилиты, отличаются применяемыми методами сжатия.
Утилита gzip использует алгоритм Deflate (свободный от патентов) и отличается высокой скоростью работы.
Ее используют для потокового сжатия данных для последующей передачи по сети.
Файлам со сжатыми данными дают расширение *.gz.
Для более эффективного сжатия используют утилиту bzip2, которая эксплуатирует алгоритм Барроуза-Уилера (файлы с расширением *.bz2).
Ее используют для разовой упаковки данных.
Существуют также утилиты lzma (алгоритм LZMA), xz (LZMA2, *.xz), lzop (LZO, *.lzo).

Указанные утилиты сжимают только один поток данных или данные из одного файла.
Чтобы сжать содержимое каталога и сохранить вложенности и атрибуты файлов, то совместно с утилитами сжатия используют утилиту tar.
Tar Объединяет файлы файловой системы в один поток с сохранением структуры каталогов и атрибутов.
А выход утилиты передается на сжатие.
Поэтому архивы в UNIX-подобных ОС имеют расширение *.tar.gz (сокращенно *.tgz), *.tar.bz2 (*.tbz2) — как результат действия двух утилит tar и gzip (bzip2).

## Самоизвлекающийся архив

Для извлечения данных из архива нужна внешняя утилита.
Она может отсутствовать у пользователя или он не умеет им пользоваться.
Для упрощения извлечения данных из архива используют самоизвлекающийся архив (SFX-архив).
Это исполняемый файл, который содержит внутри себя данные и код для их извлечения.
Для извлечения данных достаточно запустить файл на выполнение.

Кроме преимуществ в простом извлечении данных, существует недостаток — извлечение ограничивается определенной платформой.
Но в некоторых случаях данные можно извлечь архиватором непосредственно из sfx-архива.

Кроме извлечения данных в указанный каталог SFX-архив предоставляет дополнительную функциональность.
Такие архивы называются настраиваемыми.
Так, он может спросить согласия с показанной лицензией, извлечь данные в каталог, уаазанной в переменной среды, добавить ярлык на “Рабочий Стол”, в меню “Пуск” или “Автозагрузки”; задать другой значок архиву, настроить диалоговое окно — заголовок и текстовое содержимое; извлечь данные во временный каталог и запустить программу для установки и после.
Такие возможности дают архивы в WinRAR — в коммерческой утилите для Windows.

Для создания SFX-архива можно воспользоваться стандартной утилитой Windows — iexpress, расположенной в C:\Windows\System32\.
Она создает архивы в формате CAB и sfx-архивы с настройкой диалоговых окон, показом лицензии, запуском дополнительных программ после извлечения.

SFX-архивы не распространены в UNIX-подобных ОС.
Такой способ распространения программ нашел свое применение в ОС Windows.

## Установочная программа

Развитием идеи SFX-архивов стали установочные программы.
Это те же самые исполняемые файлы с архивом внутри, но в отличие от них имеют более расширенную функциональность в плане получения данных от пользователя, размещения файлов и настройки ОС.
Использование установочных программ характерной для Windows.
В начале своего появления, она не имела встроенного в систему единого способа установки сторонних программ.
Каждый разработчик сам решал, как он будет развертывать свое ПО в системе.
Эту свободную нишу в 1992 году заняла коммерческая утилита InstallShield.
По оценке разработчиков, их утилитой в 1997 году пользовались 85-90% программ, написанных для Windows.
Популярность связана с рекомендацией Microsoft разработчикам программ использовать ее для Windows 95.

Установочные программы предлагают последовательность диалогов, опрашивает пользователя о подробностях установки — согласие с лицензией, полному пути к каталогу с устанавливаемой программой, выбору языка и компонентов, заданию настроек программы и остальное.

На данный момент утилит, аналогичных InstallShield, много.
Это NSIS, Inno Setup, IzPack, Excelsior Installer, WiX Toolset, Clickteam Install Creator 2, Actual Installer, CreateInstall, Advanced Installer, BitRock InstallBuilder, InstallMate и остальное.
Они отличаются известностью, функциональностью и простотой использования, использованием графического интерфейса взамен консольного.

Альтернативой популярной и коммерческой InstallShield стала свободная утилита NSIS.
Первоначально она использовалась для формирования дистрибутива популярного тогда аудиоплеер WinAMP.
Но разработчики решили выделить удобную функциональность в отдельный продукт.
NSIS предоставляет скрипты (*.nsi) для описания последовательности действий для установки программы, специальный компилятор преобразует скрипты в установочную программу
Возможности утилиты расширяются с помощью плагинов, которые могут загружать файлы из сети, редактировать и накладывать патчи на файл, изменить внешний вид диалогов установк и много другое.

С 2000 года Microsoft ввела свои правила по установке программ.
Новые установочные пакеты имеют расширение *.msi.
Их установкой занимается служба ОС Windows Installer.
В 2004 году Microsoft выпустила набор инструментов WiX с открытой лицензией для создания установочных пакетов для Windows Installer.

## Система управления пакетами

Для распространения программ в UNIX-подобных ОС используют встроенные в ОС систему управления пакетами (СУП).
Для Debian, Ubuntu — это APT, для Red Hat Linux, Fedora, Mandriva, openSUSE — это RPM.
СУП управляет процессом установки, удаления, обновления программ и зависимых компонент.
Дистрибутивы программ берутся из репозиториев.
Репозиторий может быть удаленным (доступным черезе сеть) или локальным (подключенным через съемный носитель).
Информация об установленных программах хранится во внутренней базе данных системы.

Системы управления пакетами характерны не только для ОС, но и языков программирования для управления программными библиотеками при разработке ПО.
В Python — это pip, в Ruby — Gem, в Node.js (JavaScript) — NPM, в разработке под Windows — NuGet.

Дистрибутив для СУП называют пакетом.
Пакет может содержать или приложение или библиотеку.
Они могут входить или в двоичными файлами или исходными кодами.
Пакет состоит из файлов программы и метаданных — полное имя пакета, номер версии, описание пакета, имя разработчика, контрольная сумма, связи с другими пакетами.

Имена пакетов удовлетворяют определенному шаблону.
Оно формируется из имени и версии программы и архитектуры ОС.

Репозиторий хранит пакеты под определенную платформу или язык программирования.
Он группирует пакеты по их функциями и реализует поиск нужного пакета.
Пользователь может выбрать любой репозиторий.
Популярные репозитории имеют зеркала по всему миру, чтобы уменьшить нагрузку на основной сервер.

СУП упрощает установку, обновления и удаления программ, управляет их зависимостями (dependency hell).

СУП введет свою базу данных, в которой фиксирует установленные программы и их связи с другими программами.
При установке в систему программ другими способами, например, через исходные коды или инсталлятором, целостность внутренней БД нарушается.
Поэтому опасно устанавливать программы их исходных кодов правами администратора
Программу лучше установить в домашнем каталоге или же превратить предварительно в пакет (утилитой CheckInstall) и уже установить через СУП.

Объемные программы разбивают на несколько пакетов.
Часть программ, которая предполагается редко обновлять, выделяют в отдельный пакет.
Это уменьшает объем обновления.

## Магазин приложений

Под мобильные устройства программы распространяются централизованно — через магазины приложений.
Для каждой платформы существует свой магазин, который поддерживается разработчиком этой платформы.
Для мобильных устройств с ОС Andorid — это магазин Google Play от Google, Apple и iOS, Microsoft и Windows Phone, XBox.

Разработчики программ передают свои программы в магазин.
Организаторы проверяют программы на соответствие требованиям, после которого они становятся доступными пользователям.
Пользователь через поиск (категории) может найти нужное приложение и легко установить его на устройство (автоматическая загрузка и установка).
Магазин предоставляет возможность оценить программу (рейтинг), оставить отзыв (обзор), сообщить об ошибках.
Разработчики могут общаться с пользователями.
Лучшие программы при поиске появляются первыми.
Организатор магазина взимает оплату у пользователей за платные программы и передает деньги разработчику, забирая себе часть (комиссию).

Магазины решают многие проблемы, возникающие при распространении ПО, за счет централизации.
Но это приводит к появлению других проблем, свойственных монополии — несправедливые тарифы на услуги, цензура, отсутствие конкуренции.

Программу на мобильное устройство можно установить и без магазина приложений.
Тот же самый файл-дистрибутив, скачиваемый из магазина приложений, может быть загружен в устройство другими путями
Для устройств с ОС Android — это файл с расширением *.apk.

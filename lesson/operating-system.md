# Операционная система

Операционная система (ОС) — это комплекс взаимосвязанных программ, предназначенных для управления ресурсами компьютера и организации взаимодействия с пользователем.
ОС располагает слоем между разнообразным оборудованием и прикладным программный обеспечением.

В персональных компьютерах доминирует ОС Windows с 85%.
Далее занимает macOS от Apple с 12%.
Доля дистрибутивов Linux составляет около 2%.
Около 1% достаётся ОС Chromium.
На суперкомпьютерах принято устанавливать дистрибутивы на базе Linux.
Мобильные устройства разделяются между Android (на базе ядра Linux) и iOS (ядро XNU разработки Apple) в соотношении 86% и 14%, не оставив места другим мобильным ОС.
В сегменте веб-серверов большая часть занимает Linux — по разным источникам от 70% до 90%.
Аналогично большую часть занимает Linux в публичных облаках — до 92%.

Первые экземпляры компьютеров были дорогими.
Для их оптимального использования, программы запускались в пакетном режиме.
Программы выполнялись последовательно.
Пока первая программа выполнялась на процессоре, вторая программа загружалась в память из перфокарт.
Результаты выполнения программ записывались на перфокарте и выдавались пользователю.
Компьютер содержал загрузчик, который загружал в оперативную память программу из носителя информации и запускал ее на выполнение.
Также на компьютере был набор часто используемых функций — математических операций и операций ввода-вывода.

Первая версия ОС UNIX была разработана в конце 1969 году в AT&T тремя сотрудниками — Кеном Томпсоном, Деннисом Ритчи и Дугласом Макилроем.
В то время на компьютерах программы хранились на перфокартах и выполнялись в пакетном режиме.
Томпсону, как исследователю, был интересен способ взаимодействия с компьютером через терминал.
UNIX предоставлял более удобную среду программирования.
А разделение времени позволяло делить ресурсы компьютера между пользовательскими программами и ОС, а также организовать многопользовательский доступ к одному компьютеру.
В проекте UNIX были использованы наработки из Multics.
Изначально UNIX был написан на ассемблере, но в последующих версиях была переписана на Си.
Использование языка высокого уровня позволило программному коду абстрагироваться от конкретного процессора и системы команд.
То есть, ОС была переносимой и могла быть собрана на других аппаратных платформах.
Изначально она разрабатывалась для маломощных компьютеров.

Из-за антимонопольного законодательства AT&T не могла получать коммерческую выгоду в направлениях, не связанных с телефонией и средствами связи.
Ей предполагалось лицензировать свои технологии любому желающему.
Права на программный код UNIX были переданы университету Berkley.
Его разработки известны как BSD Unix.
В 1983 году корпорация Bell Systems была раздроблена, что позволило AT&T заняться компьютерным бизнесом.
Она занялась коммерциализацией UNIX System V и поставила запрет на распространение копий UNIX другими организациями.
Berkley исключила из своей части системы исходный код AT&T, что дало ей развивать свою свободную версию UNIX.

Так как исходную версию UNIX лицензировала много организаций, то постепенно они стали отдаляться друг от друга.
Программа, написанная для одной UNIX, не могла быть собрана на другой без значительного изменения кода.

Впервые графический интерфейс на рынке появился в продукции Apple — компьютере Macintosh с операционной системой Mac OS в 1984 году.

В мае 1985 году Microsoft представила Windows — графический интерфейс пользователя для ОС MS-DOS.
Продукт поддерживал мышь.

В 1991 году финский студент Линус Торвальдс начал разработку ядра ОС Linux.
Причиной такого поступка он назвал отсутствие свободного аналога.
Разработка была начата с нуля.
Проект перетянул на себя бездействующие силы из-за судебных споров по UNIX.
Linux притягивал к себе силы, до этого рассеянные на десятках различных частных UNIX-платформ.

Linux распространяется в виде различных дистрибутивов, которые кроме ядра, драйверов и утилит, содержат в себе различный набор пользовательских приложений.
Это Ubuntu, Scientific Linux, OpenSUSE, Debian и др.

Android, iOS, Mac OS, Ядра Linux, XNU, POSIX.
разделение полномочий.

Существуют такие системы, в которых ОС излишни.
Например, встроенные микрокомпьютеры в бытовой технике, автомобилях, игровые приставки, загружаемые программы с картриджа.
Разработчику нужна ОС, если необходима многозадачность, разделение полномочий, универсальный доступ к данным и вспомогательные библиотеки.

Операционная система состоит из следующих компонент — это ядро драйвера, системные библиотеки и оболочка с утилитами.

Ядро ОС управляет ресурсами компьютера — процессором, памятью и устройствами ввода/вывода, а также обеспечивает доступ к ним приложениям.

Доступ к аппаратному обеспечению обеспечивают специальные программы, называемые драйверами.
Драйверы устройств, из которых состоит компьютер, входят в ядро ОС.
Для остальных устройств драйверы предоставляются разработчиками этих устройств.
ОС взаимодействует с оборудованием через стандартные наборы команд.
Драйвер же переводит этот набор команд в конкретные команды, которые понимает устройство.
В такой набор команд входят погрузка/выгрузка драйвера, открытие/закрытие драйвера и чтение / запись данных.

Свойство ОС выполнять одновременно несколько программ называется многозадачностью.
Это свойство позволяет создавать интерактивные системы, организовывать взаимодействие между процессами, более полно загружать компьютер.
На одном компьютере невозможно организовать одновременное выполнение нескольких программ из-за ограниченного количества компонентов — процессора, шины данных.
Поэтому многозадачность реализуется последовательным запуском задач на короткое время.
Эту функцию выполняет часть ядра ОС — планировщик задач.

Процессорное время распределяется между приложениями планировщиком задач.
В зависимости от правил переключения задач выделяют кооперативную и вытесняющую многозадачность.
При кооперативной многозадачности задача сама решает, когда отдавать процессор другим задачам.
Это происходит при захвате уже занятого мьютекса, при ожидании ввода от пользователя, окончания вывода данных на устройство.
Недостаток тут — задача может не захотеть отдавать процессор или она может зависнуть.
В этом случае планировщик не нужен, задачи сами разбираются с последовательностью выполнения.
При вытесняющей многозадачности решение о переключение на другую задачу решает планировщик ядра ОС в зависимости от приоритета задачи и истечения заданного времени.

С каждой задачей связан набор переменных ОС и настроек процессора, который должен быть сохранен при останове задачи для последующего выполнения.
Этот набор данных называется контекстом задачи.
При переключении задач, контекст остановленной задачи сохраняется, а выполняемой задачи загружается.
Этот процесс называется переключением контекста.
Переключение контекста требует немалых ресурсов, и поэтому планировщик пытается оптимизировать и минимизировать их.
(Поток и многопоточность).

ОС занимается распределением памяти между программами.
Эту функцию выполняет менеджер виртуальной памяти.
Адресное пространство физической памяти разбивается на части фиксированного размера, называемые страницами.
Память, выделяемая для программы, складывается из множества страниц в одно целое, и называется виртуальной памятью.
Такая память имеет непрерывное пространство и ограничено только разрядностью шины данных и может превышать физическую память.
При обращении к памяти программой адрес виртуальной памяти преобразуется в адрес физической памяти — номер страницы и смещение в этой странице — с помощью блока управления памятью, которая является частью процессора.
ОС выделяет программе по необходимости память, подключая к виртуальной памяти физические страницы памяти.
Если физической памяти не хватает, то те страницы, к которым давно не происходило обращений, записываются на диск в специальный файл — swap-файл.
Этот процесс называется подкачкой страницы.

Следующая функция ядра ОС — это поддержка файловой системы.
данные на диске записываются в виде файлов.
Файлы объединяются в каталоги.
Каталог кроме файлов, также может содержать в себе другие каталоги.
С каждым файлом связаны атрибуты.

Системный вызов — это обращение прикладной программы к ядру ОС для выполнения какой-либо операции.
В отличие от обычного вызова подпрограммы, здесь выполняются привилегированные операции.
Управление передается ядру ОС, и оно проверяет, можно ли давать процессу доступ к ресурсу.
Если доступ разрешен, то выполняет запрашиваемое действие и передает управление программе.

Системные библиотеки — набор часто используемых функций, используемые для разработки ПО Windows API.

Оболочка с утилитами.
Оболочка дает пользователю возможность взаимодействия с ОС.
Для UNIX систем стандартной оболочкой является командный интерпретатор bash и sh.
В Windows — это cmd.exe, в более поздних версиях — PowerShell.
Для Windows оболочкой является Проводник.
Сюда входят рабочий стол, меню пуск, панель задач.

# Формат команд командной строки

Команда, отправляемая интерпретатору на исполнение, представлена строкой из печатных символов.
Она разделена пробельными символами (пробел или табуляция) на слова.
Эти слова называют *аргументами командной строки*.
Первый аргумент определяет название команды, а остальные задают ее входные данные и называются *аргументами команды*.

<!-- more -->

Аргументы команды делятся на опции и *свободные аргументы*.
Порядок аргументов такой, что сначала идут опции и только затем свободные аргументы.
Но на практике этот порядок может нарушаться.
Поэтому некоторые программные средства разбора аргументов сортируют их, чтобы привести порядок к нормальному виду.

Свободные аргументы указывают команде на данные, которые будут обрабатываться.
Обычно это файлы и строки.
Если ничего не указано, то некоторые команды ожидают ввода данных от пользователя.
Чтобы указать команде, что ввод окончен, используют комбинацию клавиш `Ctrl-D`.

Опции настраивают поведение команды.
Например, настраивают отображение на экран для утилит просмотра и редактирования текста -- выбор кодировки символов, нумерация строк (опция `-N` в утилите `less`), синтаксическая подстветка (опция `-Y` в утилите `nano`).
Или меняют режим работы команды, например, открытие файла редактором только для чтения (опция `-R` в утилите `vim`), поиск строки в тексте без учета регистра (опция `-i` утилиты `grep`).

Таким образом, опции указывают команде как обрабатывать, а аргументы -- что обрабатывать.

Как мы заметили выше, опции разделяются от свободных аргументов не только расположением, но и дефисом перед их имененм.
Дефис более надежное средство для визуального различения опций.
Если в имени опции только один символ, то опцию называют *короткой*.
Существуют также *длинные опции* с подробными именами.
Если в имени длинной опции более одного слова, то они разделяются дефисом, как например `--line-numbers`, `--log-file`, `--file-type`.
Длинные опции, в отличие от коротких, начинаются с двух тире.

Принято, чтобы короткая опция обязательно имела синоним в виде длинной опции.
Когда нужно быстро набрать команду, используют короткие опции.
Если необходима удобочитаемость, то выбирают длинные опции.
Также существуют длинные опции с одним дефисом, как например в команде `find`.
Но обычно в командах не смешивают разные типы длинных опций.

Опция может иметь аргумент.
Такой аргумент называют *зависимым*.
Зависимый аргумент отделяется от имени опции пробелом (`-m 20` или `--max-count 20`).
Для длинных опций аргумент может идти за знаком `=` (`--max-count=20`).
Если опция короткая, то параметр может начинаться сразу за именем опции (`-m20`).

Опция может требовать присутствие аргумента или быть без аргумента.
Опция без аргумента называют *флагом*.
Но есть третий случай -- опция с необязательным аргументом.
Например `--color` в утилите `ls` использует цвет, чтобы различать типы файлов.
Часто раскраска уже включена по умолчанию.
И если необходимо ее отключить, то используют ту же опцию, но с аргументом: `--color=never`.

Короткие опции без аргумента можно объединить под одним дефисом.
Это удобно, когда надо быстро набрать команду.
Так, `ls -a -l -h` эквивалентна `ls -alh`.

Если аргумент состоит из разделенных пробелами слов, то его помещают в кавычки.
Иначе он разобъется на отдельные аргументы.
Пробел часто встречается в путях к пользовательским файлам.
Например, это каталоги `Рабочий стол`, `VirtualBox VMs`, `Мои проекты`.
Пробельный символ допустим в названиях файлов, но он доставляет неудобства в оформлении аргументов командной строки.
Поэтому в названиях системных файлов, каталогов, файлов с проектами программ пробел заменяют на символы дефиса (`-`) или подчеркивания (`_`).

Одна опция в одной строке может встретиться несолько раз, но разными аргументами.
В таком случае поведение команды зависит от того, будет ли опция взаимоисключающей.
Если да, то последняя из них перекроет остальные.
Если нет, то их аргументы объединятся. 

Одна опция может иметь несколько зависимых аргументов.
Чтобы передать их в опцию, они обрамляются кавычками, а внутри получившейся строки разделяются пробелом или запятой, как например (нужен реальный пример):

```-u"size,format,type"```
```-u"size format type"```

Символ дефиса для выделения опций среди аргументов выбран не случайно.
Он редко встречается в начале названия файлов.
Но как быть, если все-таки такой файл встретится? Специальный аргумент командной строки вида `--` явно указывает на конец перечисления опций.
После него идут только свободные аргументы.
Его используют, когда название файла похоже на опцию.
Например, чтобы создать каталог с именем `--version` и перейти на него, получится только так:

```mkdir -- --version && cd -- --version```

Без аргумента `--` здесь не обойтись, так как иначе команды `mkdir --version` и `cd --version` выведут на экран свои номера версий.

Специальный аргумент вида `-` в зависимости от команды рассматривается как стандартный ввод (клавиатура) или вывод (экран).
(Пример).

Перечисленные выше правила использовани аргументов командной строки выработались на практике в течение долгого времени.
Правила перечислены в стандарте POSIX в виде соглашений.
Так, стандарт ограничивает название команд от 2 до 9 строчными и цифровыми символами.
Имя опций может содержать только буквы и цифры.
Но не может состоять исключительно из цифр.
Набирать только строчные буквы удобно только потому, что не надо тянуть мизинчик к клавише `shift`.
Да и короткие имена быстрее набираются.
Но соглашения не обязательны для выполнения.
Их можно нарушить, но это будет себе дороже.
Мало кто читал соглашения POSIX, но многие догадываются о них, так как они реализованы в большинстве утилит.
Поэтому их нарушение только оттолкнет пользователей от программы.
Но все же правила нарушаются.
Например, нестандартные опция `+x` в команде `chmod`.
Но это связано тем, что такие команды появились раньше, чем были приняты соглашения.

Команды (утилиты командной строки в встроенные в интерпретатор) спроектированы таким образом, что они хорошо решают небольшую задачу.
Название команды говорит нам об этой задаче.
Именно поэтому ОС UNIX содержит большое количество разнообразных утилит.
Вы их можете увидеть в каталогах `/bin`, `/sbin`, `/usr/bin`, `/usr/sbin` командой `ls`.
Но существуют особые многофункциональные утилиты.
Они решают множество разнообразных задач, но в определенной узкой области.
Например, это утилиты `ip`, ... для настройки сети и утилиты `hg`, `git` для управления версиями документов.
рассмотрим команду и связанную с ней утилиту `git`.
`Git` предоставляет десятки команд для просмотра и управления изменениями документов.
Это команды `clone`, `update`, `commit`, `diff`, `status` и многое другое.
Все они встроены водну команду `git` и имет формат для вызова:

```git command [options][args]```

Чтобы зафиксировать изменения в истории проекта используется строк `git commit -m "Change description"`.
Здесь мы видим особый аргумент действия.
Если выше действие указывалось в названии команды (в виде глагола), то тут команда -- это азвнаие инструмента (в виде существительного).

Аналогично обстоят дела с утилитой `ip` для настройки сети.
Но в отличие от `git`, здесь мы увидим двухуровневый выбор действия.
Формат вызова команды представлен в виде

```ip [options] object action```

(Подробнее про команду `ip`).
Чтобы посмотреть список локальных сетевых интерфейсов используется команда `ip addr show`.

Зарезервированная опция `-W`.

## Вопросы для самоконтроля

1. Посмотрите рисунок ниже и перечислите на ней термины, которые были введены в этой лекции.
2. Команда `mkdir dir` создает каталог под названием `dir` в текущем каталоге.
   Создайте каталог с названиями `--help`, `-`, `@`, `&`, `$`, `"`, `/`.
3. Как вызовите программу из командной строки в названии которого (`ls --help`) есть пробел?
